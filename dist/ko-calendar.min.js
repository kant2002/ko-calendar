/*! ko-calendar.js v0.3.0 */
!function(a,b){"function"==typeof define&&define.amd?define(["knockout","moment"],function(c,d){b.call(a,window,document,c,d)}):b.call(a,window,document,ko,moment)}(this,function(a,b,c,d){var e="calendar",f={deepExtend:function(a,b){var c;for(c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},f.deepExtend(a[c],b[c])):a[c]=b[c];return a},isBoolean:function(a){return"boolean"==typeof a}},g=function(g){var h=this,i=g&&g.locale?g.locale:d.locale();d.locale(i);var j,k=d.localeData(),l=k.longDateFormat("LTS"),m=g&&f.isBoolean(g.militaryTime)?g.militaryTime:"A"!==l.charAt(l.length-1),n=k.months().slice(0),o=k.weekdaysMin().slice(0),p=k.firstDayOfWeek(),q=!g||!f.isBoolean(g.showTime)||g.showTime;if(j=g&&g.format?g.format:q?"L LTS":"L",h.opts={value:c.observable(),current:d(),deselectable:!0,showCalendar:!0,showToday:!0,showTime:q,showNow:!0,militaryTime:m,min:null,max:null,autoclose:!0,firstDay:p,locale:i,format:j,strings:{months:n,days:o,time:["AM","PM"]}},f.deepExtend(h.opts,g),!h.opts.showCalendar&&!h.opts.showTime)return console.error("Silly goose, what are you using ko-%s for?",e);h.constants={daysInWeek:7,dayStringLength:2},h.dayLabels=h.opts.strings.days,h.opts.firstDay>0&&h.opts.firstDay<=6&&(h.dayLabels=h.dayLabels.splice(h.opts.firstDay).concat(h.dayLabels)),h.utils={date:{isValid:function(a){var b=d(a);return b.isValid()},normalize:function(a){var b=a.clone();return b.hours(0).minutes(0).seconds(0).milliseconds(0),b},isSame:function(a,b){return!(!a||!b)&&(a.isSame(b,"day")&&a.isSame(b,"month")&&a.isSame(b,"year"))},isSameMonth:function(a,b){return!(!a||!b)&&a.isSame(b,"month")},isWeekend:function(a){return!!a&&(0===a.day()||a.day()==h.constants.daysInWeek-1)},isWithinMinMaxDateRange:function(a){return!!a&&(!h.opts.min&&!h.opts.max||!(h.opts.min&&h.utils.date.normalize(h.opts.min)>a)&&!(h.opts.max&&h.utils.date.normalize(h.opts.max)<a))}},time:{handleSuffixCheck:function(a){var b=a.hours();return b>=12?b-=12:b<12&&(b+=12),a.hours(b)},checkMinTimeRange:function(a){if(!a||!h.value()||!h.opts.min&&!h.opts.max)return!1;var b=h.value().clone();return"suffix"===a.type?b=h.utils.time.handleSuffixCheck(b):"hours"!==a.type&&"minutes"!==a.type||b.subtract(1,a.type),!!(h.opts.max&&h.opts.max<b)||!!(h.opts.min&&h.opts.min>b)},checkMaxTimeRange:function(a){if(!a||!h.value()||!h.opts.min&&!h.opts.max)return!1;var b=h.value().clone();return"suffix"===a.type?b=h.utils.time.handleSuffixCheck(b):"hours"!==a.type&&"minutes"!==a.type||b.add(1,a.type),!!(h.opts.min&&h.opts.min>b)||!!(h.opts.max&&h.opts.max<b)}},strings:{pad:function(a){return a<10?"0"+a:a}},element:{offset:function(c){var d=c.getBoundingClientRect(),e=b.documentElement;return{top:d.top+a.pageYOffset-e.clientTop,left:d.left+a.pageXOffset-e.clientLeft}},height:function(a){return a.offsetHeight},isDescendant:function(a,b){for(var c=b.parentNode;null!==c;){if(c==a)return!0;c=c.parentNode}return!1}}};var r=d();return h.current=c.observable(h.opts.current||r),c.isObservable(h.opts.value)?(h.value=h.opts.value,h.value().locale(h.opts.locale),h.opts.showToday&&!h.utils.date.isWithinMinMaxDateRange(h.utils.date.normalize(r))&&(h.opts.showToday=!1),h.opts.showNow&&(h.opts.min&&h.opts.min>=r||h.opts.max&&h.opts.max<=r)&&(h.opts.showNow=!1),h.label=c.computed({read:function(){var a=h.value();return null!==a&&void 0!==a&&d.isMoment(a)?a.format(h.opts.format):null},write:function(a){h.utils.date.isValid(a)?h.value(d(a,h.opts.format)):h.value(null)}}),h.calendar={select:function(a,b){return h.opts.deselectable&&h.utils.date.isSame(h.value(),a)?h.value(null):(h.opts.min&&h.utils.date.isSame(a,h.opts.min)?h.value(h.opts.min.clone()):h.value(a.clone()),void(h.input()&&h.opts.autoclose&&h.visible(!1)))},selectToday:function(a,b){var c=h.utils.date.normalize(d());h.utils.date.isSame(h.value(),c)||(h.calendar.select(c),h.current(c),h.value(c))},next:function(){var a=h.current();a.date(1).add(1,"month"),h.current(a.clone())},prev:function(){var a=h.current();a.date(1).subtract(1,"month"),h.current(a.clone())},sheet:c.computed(function(){var a=h.utils.date.normalize(h.current());a.date(1);var b=a.day(),c=a.date()-b+h.opts.firstDay;b<h.opts.firstDay&&(c-=7),a.date(c);for(var e=[],f=0,g=!1,i=!1,j=!1;;){if(e[f]||(e[f]=[]),e[f].length!==h.constants.daysInWeek&&(e[f].push(d(a.valueOf())),a.add(1,"day")),a.isSame(h.current(),"month")&&(g=!0),g&&!a.isSame(h.current(),"month")&&(i=!0),i&&e[f].length==h.constants.daysInWeek&&(j=!0),i&&j)break;e[f].length==h.constants.daysInWeek&&f++}return e})},h.time={next:function(a,b){return h.value()?void h.value(a.set(a.get()+1).clone()):h.time.selectNow()},prev:function(a,b){return h.value()?void h.value(a.set(a.get()+1).clone()):h.time.selectNow()},selectNow:function(){var a=d();h.value(a),h.current(a),h.input()&&h.opts.autoclose&&h.visible(!1)},sheet:c.observableArray([{type:"hours",get:function(){return h.value().hour()},set:function(a){return h.value().hour(a)}},{type:"minutes",get:function(){return h.value().minute()},set:function(a){return h.value().minute(a)}}]),text:function(a){if(!h.value())return"-";switch(a.type){case"suffix":return a.get()?h.opts.strings.time[1]:h.opts.strings.time[0];case"hours":var b=a.get();return!h.opts.militaryTime&&(b>12||0===b)&&(b-=12),Math.abs(b);default:return h.utils.strings.pad(a.get())}}},h.opts.militaryTime||h.time.sheet.push({type:"suffix",get:function(){return h.value()&&h.value().hour()<12?0:1},set:function(a){var b=h.value().hour();return b>=12?b-=12:b<12&&(b+=12),h.value().hour(b)}}),h.input=c.observable(!1),h.visible=c.observable(!0),h):console.error("value must be an observable")},h='<div class="ko-calendar" data-bind="with: $data, visible: (opts.showCalendar || opts.showTime) && visible(), attr: { \'data-opts\': JSON.stringify(opts) } ">            <!-- ko if: opts.showCalendar -->            <table data-bind="css: { selected: value } " class="calendar-sheet">                <thead>                    <tr class="month-header">                        <th>                            <a href="#" data-bind="click: calendar.prev" class="prev">&laquo;</a>                        </th>                        <th data-bind="attr: { colspan: constants.daysInWeek - 2 } ">                            <b data-bind="text: opts.strings.months[current().month()] + \' \' + current().year()"></b>                        </th>                        <th>                            <a href="#" data-bind="click: calendar.next" class="next">&raquo;</a>                        </th>                    </tr>                    <tr data-bind="foreach: dayLabels">                        <th data-bind="text: $data"></th>                    </tr>                </thead>                <tbody data-bind="foreach: calendar.sheet">                    <tr class="week" data-bind="foreach: $data">                        <td class="day" data-bind="css: { weekend: $parents[1].utils.date.isWeekend($data), today: $parents[1].utils.date.isSame(moment(), $data), inactive: !($parents[1].utils.date.isSameMonth($parents[1].current(), $data)), outofrange: !($parents[1].utils.date.isWithinMinMaxDateRange($data)) } ">                            <a href="javascript:;" data-bind="text: $data.date(), attr: { title: $data }, click: $parents[1].calendar.select, css: { active: $parents[1].utils.date.isSame($parents[1].value(), $data) } "></a>                        </td>                    </tr>                </tbody>                <!-- ko if: opts.showToday -->                    <tfoot>                        <tr>                            <td data-bind="attr: { colspan: constants.daysInWeek } ">                                <a href="javascript:;" data-bind="click: calendar.selectToday">Today</a>                            </td>                        </tr>                    </tfoot>                <!-- /ko -->            </table>            <!-- /ko -->            <!-- ko if: opts.showTime -->            <table class="time-sheet">                <tbody>                    <tr data-bind="foreach: time.sheet">                        <td data-bind="css: { outofrange: $parent.utils.time.checkMaxTimeRange($data) }">                            <a href="#" class="up" data-bind="click: $parent.time.next"></a>                        </td>                    </tr>                    <tr data-bind="foreach: time.sheet">                        <td data-bind="css: { colon: $index() === 0, inactive: !$parent.value() }, text: $parent.time.text($data)"></td>                    </tr>                    <tr data-bind="foreach: time.sheet">                        <td data-bind="css: { outofrange: $parent.utils.time.checkMinTimeRange($data) }">                            <a href="#" class="down" data-bind="click: $parent.time.prev"></a>                        </td>                    </tr>                </tbody>                <!-- ko if: opts.showNow -->                    <tfoot>                        <tr>                            <td data-bind="attr: { colspan: time.sheet().length } ">                                <a href="javascript:;" data-bind="click: time.selectNow">Now</a>                            </td>                        </tr>                    </tfoot>                <!-- /ko -->            </table>            <!-- /ko -->        </div>',i=function(a,d){var e,f=new g(d);if("INPUT"==a.tagName){var i=b.createElement("div");i.innerHTML=h,e=i.children[0],b.body.appendChild(e),f.input(!0),f.visible(!1),c.utils.registerEventHandler(a,"focus",function(b){setTimeout(function(){var b=f.utils.element.offset(a),c=f.utils.element.height(a),d=[window.innerWidth-e.offsetWidth-20,b.left];e.style.position="absolute",e.style.top=b.top+c+5+"px",e.style.left=Math.min.apply(null,d)+"px"}),f.visible(!0)}),c.utils.registerEventHandler(a,"keydown",function(a){var b={9:!0,27:!0,46:!0,13:!0};a.which in b&&f.visible(!1)}),c.utils.registerEventHandler(b,"mousedown",function(b){b.target==a||b.target==e||f.utils.element.isDescendant(e,b.target)?a.focus():f.visible(!1)}),c.applyBindingsToNode(a,{value:f.label})}else a.innerHTML=h,e=a.children[0];c.applyBindings(f,e)};c.components.register(e,{viewModel:g,template:h}),c.bindingHandlers[e]={init:function(a,b){return i(a,c.unwrap(b())),{controlsDescendantBindings:!0}}},c[e]=i});